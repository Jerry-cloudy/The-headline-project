"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[756],{8756:function(t,e,s){s.r(e),s.d(e,{default:function(){return X}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"黑马头条"},scopedSlots:t._u([{key:"left",fn:function(){return[e("van-icon",{attrs:{name:"arrow-left"},on:{click:function(e){return t.$router.back()}}})]},proxy:!0}])}),e("div",{staticClass:"main-wrap"},[t.loading?e("div",{staticClass:"loading-wrap"},[e("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v(" 加载中 ")])],1):t.article.title?e("div",{staticClass:"article-detail"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),e("van-cell",{staticClass:"user-info",attrs:{center:"",border:!1}},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.article.aut_photo},slot:"icon"}),e("div",{staticClass:"user-name",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.aut_name))]),e("div",{staticClass:"publish-date",attrs:{slot:"label"},slot:"label"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))]),e("FollowUser",{attrs:{userId:t.article.aut_id,isFollowed:t.article.is_followed},on:{"update:isFollowed":function(e){return t.$set(t.article,"is_followed",e)},"update:is-followed":function(e){return t.$set(t.article,"is_followed",e)}}})],1),e("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),e("van-divider",[t._v("正文结束")]),e("CommentList",{ref:"CommentList",attrs:{targetId:t.articleId,totalCount:t.totalCommentCount},on:{"update:totalCount":function(e){t.totalCommentCount=e},"update:total-count":function(e){t.totalCommentCount=e},"reply-click":t.onReplyClick}},[t._v(" 评论 ")])],1):404==t.errStatus?e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("内容加载失败！")]),e("van-button",{staticClass:"retry-btn",on:{click:t.loadArticle}},[t._v("点击重试")])],1)]),e("div",{staticClass:"article-bottom"},[e("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v(" 写评论 ")]),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("CommentPost",{attrs:{targetId:t.article.art_id},on:{"post-success":t.postSuccess}})],1),e("van-icon",{attrs:{name:"comment-o",badge:t.totalCommentCount,color:"#777"}}),e("CollectArticle",{attrs:{articleId:t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),e("LikeArticle",{attrs:{articleId:t.article.art_id,attitude:t.article.attitude},on:{"update:attitude":function(e){return t.$set(t.article,"attitude",e)}}}),e("van-icon",{attrs:{name:"share",color:"#777777"}})],1),e("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?e("CommentReply",{attrs:{comment:t.currentComment},on:{close:function(e){t.isReplyShow=!1}}}):t._e()],1)],1)},a=[],i=s(4599),n=s(6471),l=function(){var t=this,e=t._self._c;return t.isFollowed?e("van-button",{staticClass:"follow-btn",attrs:{type:"info",color:"#3296fa",round:"",size:"small",icon:"plus",loading:t.btnLoading},on:{click:t.onFollow}},[t._v("关注")]):e("van-button",{staticClass:"follow-btn",attrs:{round:"",size:"small",loading:t.btnLoading},on:{click:t.onFollow}},[t._v("已关注")])},r=[],c={name:"FollowUser",props:{isFollowed:{type:Boolean,default:!0},userId:{type:String,default:""}},data(){return{btnLoading:!1}},methods:{async onFollow(){this.btnLoading=!0;try{this.isFollowed?await(0,i.YE)(this.userId):await(0,i.u5)(this.userId),this.$emit("update:isFollowed",!this.isFollowed)}catch(t){t.response&&400===t.response.status?this.$toast("你不能关注你自己"):this.$toast("操作失败，请稍后重试")}this.btnLoading=!1}}},m=c,d=s(1001),u=(0,d.Z)(m,l,r,!1,null,"04f90f82",null),p=u.exports,h=function(){var t=this,e=t._self._c;return e("van-icon",{class:{collected:t.value},attrs:{name:t.value?"star":"star-o",loading:t.loading},on:{click:t.onCollect}})},f=[],v={name:"CollectArticle",props:{value:{type:Boolean,default:!1},articleId:{type:String,default:""}},data(){return{loading:!1}},methods:{async onCollect(){this.loading=!0;try{this.value?await(0,i.u1)(this.articleId):await(0,i.$c)(this.articleId),this.$emit("input",!this.value),this.$toast.success(this.value?"取消收藏":"收藏成功")}catch(t){this.$toast.fail("操作失败，请重试！")}this.loading=!1}}},C=v,_=(0,d.Z)(C,h,f,!1,null,"278db8d6",null),g=_.exports,y=function(){var t=this,e=t._self._c;return e("van-icon",{class:{liked:1===t.attitude},attrs:{name:1===t.attitude?"good-job":"good-job-o",loading:t.loading},on:{click:t.onLike}})},w=[],b={name:"LikeArticle",props:{attitude:{type:Number,default:-1},articleId:{type:String,default:""}},data(){return{loading:!1}},inject:{articleIdPro:{type:String,default:""}},mounted(){},methods:{async onLike(){this.loading=!0;let t=this.attitude;try{1===this.attitude?(t=-1,await(0,i.nD)(this.articleId)):(t=1,await(0,i.IF)(this.articleId)),this.$emit("update:attitude",t)}catch(e){this.$toast.fail("操作失败，请重试！")}this.loading=!1}}},k=b,I=(0,d.Z)(k,y,w,!1,null,"1c7c06f2",null),S=I.exports,L=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-list"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(s,o){return e("CommentItem",{key:o,attrs:{comment:s},on:{"reply-click":t.onReplyClick}})})),1)],1)},$=[],x=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"comment-item"},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.comment.aut_photo},slot:"icon"}),e("div",{staticClass:"title-wrap",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"user-name"},[t._v(t._s(t.comment.aut_name))]),e("van-button",{staticClass:"like-btn",class:{liked:t.comment.is_liking},attrs:{icon:t.comment.is_liking?"good-job":"good-job-o",loading:t.commentLoading},on:{click:function(e){return t.onCommentLike(t.item)}}},[t._v(t._s(t.comment.like_count||"赞"))])],1),e("div",{attrs:{slot:"label"},slot:"label"},[e("p",{staticClass:"comment-content"},[t._v(t._s(t.comment.content))]),e("div",{staticClass:"bottom-info"},[e("span",{staticClass:"comment-pubdate"},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),e("van-button",{staticClass:"reply-btn",attrs:{round:""},on:{click:function(e){return t.$emit("reply-click",t.comment)}}},[t._v(" 回复 "+t._s(t.comment.replay_count)+" ")])],1)])],1)},P=[],F={name:"CommentItem",props:{comment:{type:Object,default:()=>({})}},data(){return{commentClone:this.comment,commentLoading:!1}},methods:{async onCommentLike(){this.commentLoading=!0;try{this.comment.is_liking?(await(0,i.IY)(this.comment.com_id),this.commentClone.like_count--):(await(0,i._7)(this.comment.com_id),this.commentClone.like_count++),this.commentClone.is_liking=!this.comment.is_liking}catch(t){this.$toast("操作失败，请重试")}this.commentLoading=!1}}},R=F,A=(0,d.Z)(R,x,P,!1,null,"067e2050",null),Z=A.exports,j={name:"CommentList",components:{CommentItem:Z},props:{targetId:{type:String,default:""},totalCount:{type:Number,default:0},type:{type:String,default:"a"}},data(){return{list:[],loading:!1,finished:!1,error:!1,offset:null}},methods:{async onLoad(){try{const{data:t}=await(0,i.nr)({type:this.type,source:this.targetId,offset:this.offset,limit:10});this.list.push(...t.data.results),this.$emit("update:totalCount",t.data.total_count),this.loading=!1,t.data.results.length?this.offset=t.data.last_id:this.finished=!0}catch(t){this.error=!0,this.loading=!1}},unshiftComment(t){this.list.unshift(t.data.new_obj)},onReplyClick(t){this.$emit("reply-click",t)}}},z=j,T=(0,d.Z)(z,L,$,!1,null,"06d60b80",null),U=T.exports,q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-comment"},[e("van-field",{staticClass:"post-field",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"50",placeholder:"优质评论将会被优先展示","show-word-limit":""},model:{value:t.message,callback:function(e){t.message="string"===typeof e?e.trim():e},expression:"message"}}),e("van-button",{staticClass:"post-btn",attrs:{size:"small",disabled:!t.message.length},on:{click:function(e){return t.onAddComment()}}},[t._v("发布")])],1)},B=[],D={name:"CommentPost",props:{targetId:{type:String,default:""},articleId:{type:String,default:""}},data(){return{message:""}},methods:{async onAddComment(){try{console.log(this.targetId,"id");const t=this.message.trim();if(!t.length)return;const e=await(0,i.AD)({target:this.targetId,content:t,art_id:this.articleId||null});this.$toast.success("发布成功"),this.$emit("post-success",e.data),this.message=""}catch(t){this.$toast.fail("发布失败")}}}},E=D,N=(0,d.Z)(E,q,B,!1,null,"f0d01170",null),O=N.exports,Y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-reply"},[e("van-nav-bar",{attrs:{title:t.comment.reply_count>0?`${t.comment.reply_count}条回复`:"暂无回复","left-arrow":"",fixed:""},scopedSlots:t._u([{key:"left",fn:function(){return[e("van-icon",{attrs:{name:"cross"},on:{click:function(e){return t.$emit("close")}}})]},proxy:!0}])}),e("div",{staticClass:"scroll-wrap"},[e("CommentItem",{attrs:{comment:t.comment}}),e("van-cell",[t._v("全部回复")]),e("CommentList",{ref:"CommentList",attrs:{targetId:t.comment.com_id,type:"c"}})],1),e("div",{staticClass:"reply-bottom"},[e("van-button",{staticClass:"reply-btn",attrs:{round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v(" 写评论 ")]),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("CommentPost",{attrs:{targetId:t.comment.com_id,articleId:t.$route.params.articleId},on:{"post-success":t.postSuccess}})],1)],1)],1)},H=[],M={name:"CommentReply",components:{CommentItem:Z,CommentList:U,CommentPost:O},props:{comment:{type:Object,default:()=>({})}},data(){return{isPostShow:!1}},methods:{postSuccess(t){this.isPostShow=!1,this.$refs.CommentList.unshiftComment(t)}}},G=M,J=(0,d.Z)(G,Y,H,!1,null,"bce83172",null),K=J.exports,Q={name:"article-",components:{FollowUser:p,CollectArticle:g,LikeArticle:S,CommentList:U,CommentPost:O,CommentReply:K},data(){return{article:{},loading:!0,errStatus:0,totalCommentCount:0,isPostShow:!1,isReplyShow:!1,currentComment:{}}},props:{articleId:{type:String,required:!0,default:""}},provide:function(){return{articleIdPro:this.articleId}},created(){this.loadArticle()},methods:{async loadArticle(){this.loading=!0;try{const{data:t}=await(0,i.rk)(this.articleId);this.article=t.data,setTimeout((()=>{this.previewImage()}),0)}catch(t){t.response&&404===t.response.status&&(this.errStatus=404)}this.loading=!1},previewImage(){const t=this.$refs["article-content"],e=t.querySelectorAll("img"),s=[...e].map((t=>t.src));e.forEach(((t,e)=>{t.onclick=()=>{(0,n.Z)({images:s,startPosition:e})}}))},onUpdateFollow(t){this.article.is_followed=t},postSuccess(t){this.isPostShow=!1,this.$refs.CommentList.unshiftComment(t)},onReplyClick(t){this.currentComment=t||{},this.isReplyShow=!0}}},V=Q,W=(0,d.Z)(V,o,a,!1,null,"66a18553",null),X=W.exports}}]);
//# sourceMappingURL=756.97a19baf.js.map