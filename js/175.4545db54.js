"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[175],{9175:function(t,e,s){s.r(e),s.d(e,{default:function(){return I}});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-container"},[e("form",{attrs:{action:"/"}},[e("van-search",{attrs:{"show-action":"",background:"#3296fa",placeholder:"请输入搜索关键词"},on:{search:t.onSearch,cancel:t.onCancel,focus:function(e){t.isResultShow=!1}},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),t.isResultShow?e("SearchResult",{attrs:{searchText:t.searchText}}):t.searchText.trim()?e("SearchSuggestion",{attrs:{searchText:t.searchText},on:{search:t.onSearch}}):e("SearchHistory",{attrs:{searchHistories:t.searchHistories},on:{emptyHistories:function(e){t.searchHistories=[]},searchWord:t.onSearch}})],1)},a=[],i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-history"},[e("van-cell",{attrs:{title:"搜索历史"}},[t.isDelBtnShow?[e("span",{on:{click:function(e){return t.$emit("emptyHistories")}}},[t._v("全部删除")]),t._v("    "),e("span",{on:{click:function(e){t.isDelBtnShow=!1}}},[t._v("完成")])]:e("van-icon",{attrs:{name:"delete"},on:{click:function(e){t.isDelBtnShow=!0}}})],2),t._l(t.searchHistories,(function(s,r){return e("van-cell",{key:r,attrs:{title:s},on:{click:function(e){return t.onSearchItemClick(s,r)}}},[t.isDelBtnShow?e("van-icon",{attrs:{name:"close"}}):t._e()],1)}))],2)},n=[],o={name:"SearchHistory",props:{searchHistories:{type:Array,required:!0,default:()=>[]}},data(){return{isDelBtnShow:!1,searchHistoriesClone:this.searchHistories}},methods:{onSearchItemClick(t,e){this.isDelBtnShow?this.searchHistoriesClone.splice(e,1):this.$emit("searchWord",t)}}},c=o,h=s(1001),l=(0,h.Z)(c,i,n,!1,null,"e77d1b22",null),u=l.exports,d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-suggestion"},t._l(t.suggestionList,(function(s,r){return e("van-cell",{key:r,attrs:{icon:"search"},on:{click:function(e){return t.$emit("search",s)}},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{domProps:{innerHTML:t._s(t.highLight(s))}})]},proxy:!0}],null,!0)})})),1)},p=[],S=s(4599),f=s(430),g={name:"SearchSuggestion",data(){return{suggestionList:[]}},props:{searchText:{type:String,default:""}},watch:{searchText:{handler:(0,f.debounce)((function(t){this.loadSearchSuggestion(t)}),200),immediate:!0}},methods:{async loadSearchSuggestion(t){try{const{data:e}=await(0,S.hz)(t);e.data.options&&null==e.data.options[0]&&(e.data.options[0]=this.searchText),this.suggestionList=e.data.options}catch(e){this.$toast("获取列表失败")}},highLight(t){const e=`<span style="color:rgb(77, 150, 243)">${this.searchText}</span>`;return t.split(this.searchText).join(e)}}},x=g,m=(0,h.Z)(x,d,p,!1,null,"e24a8580",null),_=m.exports,T=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-result"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{load:t.onLoad,"update:error":function(e){t.error=e}},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t){return e("van-cell",{key:t.art_id,attrs:{title:t.title}})})),1)],1)},H=[],v={name:"SearchResult",data(){return{list:[],loading:!1,finished:!1,page:1,perPage:20,error:!1}},props:{searchText:{type:String,default:""}},methods:{async onLoad(){try{const{data:t}=await(0,S.Sx)({page:this.page,per_page:this.perPage,q:this.searchText});this.list.push(...t.data.results),this.loading=!1,t.data.results.length?this.page++:this.finished=!0}catch(t){this.error=!0,this.loading=!1,this.$toast("加载失败，请稍后重试")}}}},y=v,k=(0,h.Z)(y,T,H,!1,null,"49f892bc",null),w=k.exports,C=s(7247),R={name:"SearchPage",components:{SearchHistory:u,SearchSuggestion:_,SearchResult:w},data(){return{searchText:"",isResultShow:!1,searchHistories:(0,C.rV)("TOUTIAO_SEARCH_HISTORIES")||[]}},watch:{searchHistories:{handler(t){(0,C.LS)("TOUTIAO_SEARCH_HISTORIES",t)},deep:!0}},methods:{onSearch(t){this.searchText=t;const e=this.searchHistories.indexOf(t);-1!==e&&this.searchHistories.splice(e,1),this.searchHistories.unshift(t),this.isResultShow=!0},onCancel(){this.$toast("取消"),this.$router.back()}}},b=R,L=(0,h.Z)(b,r,a,!1,null,"25093c03",null),I=L.exports}}]);
//# sourceMappingURL=175.4545db54.js.map